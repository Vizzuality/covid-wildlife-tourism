<div id="drawer" class="dialog-container" aria-hidden="true">
  <div tabindex="-1" data-a11y-dialog-hide></div>
  <div role="dialog" aria-label="<%= t("views.map.drawer_menu") %>" class="d-flex flex-column c-drawer">
    <div class="flex-shrink-0 pt-5 pb-4 background-black">
      <div class="container">
        <% if user_signed_in? %>
        <%= current_user.display_name %>
        <% else %>
        <%= link_to t("views.shared.log_in"), new_user_session_path %>
        <% end %>
      </div>
    </div>
    <div class="flex-grow-1 pt-4 pb-5 d-flex flex-column justify-content-between background-white">
      <div class="container">
        <label for="map-view"><%= t('views.map.map_view') %></label>
        <select class="custom-select js-map-view">
          <option value="standard"><%= t('views.map.standard') %></option>
          <option value="satellite"><%= t('views.map.satellite') %></option>
        </select>

        <div class="mt-4 custom-control custom-switch">
          <input type="checkbox" id="toggle-protected-areas" class="custom-control-input js-protected-areas-toggle">
          <label class="custom-control-label" for="toggle-protected-areas">
            <%= t("views.map.protected_areas_layer") %>
          </label>
        </div>

        <% if user_signed_in? && current_user.admin? %>
        <%= link_to t("views.shared.pins_list"), admin_stores_path, class: 'd-block mt-4' %>
        <% end %>
      </div>
      <div class="container">
        <% if user_signed_in? %>
        <%= link_to t("views.shared.edit_profile"), edit_user_registration_path, class: 'd-block mb-4' %>
        <%= link_to t("views.shared.log_out"), destroy_user_session_path, class: 'd-block' %>
        <% end %>
      </div>
    </div>
  </div>
</div>

<% if !user_signed_in? %>
<div id="login-wall" class="dialog-container" aria-hidden="true">
  <div tabindex="-1" data-a11y-dialog-hide></div>
  <div role="dialog" aria-label="<%= t("views.map.login_or_register") %>" class="c-login-wall">
    <div class="background-black">
      <div class="container">
        <div class="position-relative">
          <button type="button" class="position-absolute mt-2 btn btn-black" data-a11y-dialog-hide style="top: 0; right: 0;">
            <svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" class="d-block" aria-label="<%= t("views.shared.close_dialog") %>">
              <path d="M21.677 0l2.19 2.121-9.532 9.517.375.362-.375.362 9.532 9.517L21.677 24 12 14.625 2.323 24l-2.19-2.121 9.531-9.517L9.29 12l.374-.362-9.53-9.517L2.322 0 12 9.375 21.677 0z" fill="#FFF" fill-rule="evenodd" />
            </svg>
          </button>
        </div>

        <div class="pt-5 pb-4">
          <h1 class="mt-3 mb-5 font-base text-center">
            <%= t('views.layout.application.title') %>
          </h1>
          <p class="mb-5 font-s">
            <%= t('views.map.login_wall_intro') %>
          </p>

          <%= link_to t('views.shared.log_in'), new_user_session_path, class: 'mt-4 btn btn-block btn-secondary' %>
          <%= link_to t('views.shared.register'), new_user_registration_path, class: 'btn btn-block btn-primary' %>
        </div>
      </div>
    </div>
  </div>
</div>
<% end %>

<div id="pin-details" class="dialog-container" aria-hidden="true">
  <div tabindex="-1" hidden></div>
  <div role="alertdialog" aria-label="<%= t("views.map.pin_details") %>" class="c-pin-details">
    <div class="py-4 background-white box-shadow-white">
      <div class="container">
        <strong class="d-block mb-2 js-name"></strong>
        <a class="mb-0 js-website" target="_blank" rel="noopener noreferrer" hidden></a>

        <div class="mt-4 js-edit-group" hidden>
          <div class="d-flex justify-content-between">
            <a data-href="<%= edit_pin_path(':id') %>" class="btn btn-block btn-primary mr-3 js-edit">
              <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" class="d-inline-block mr-1 align-middle">
                <path d="M0 18h3.8l11-11.1L11 3.1 0 14.2V18zM17.7 2.6L15.4.3c-.4-.4-1-.4-1.4 0l-1.8 1.8L16 5.9 17.7 4c.4-.4.4-1 0-1.4z" fill="#222" fill-rule="evenodd" />
              </svg>
              <%= t('views.shared.edit') %>
            </a>
            <a data-href="<%= pin_path(':id') %>" data-method="delete" data-confirm="<%= t('views.shared.delete_confirmation') %>" class="btn btn-block btn-black mt-0 js-delete">
              <%= t('views.shared.delete') %>
            </a>
          </div>
        </div>

        <div class="mt-4 js-report-error-group" hidden>
          <<%== user_signed_in? ? 'a data-href="' + edit_pin_path(':id') + '"' : 'button type="button" data-a11y-dialog-show="login-wall"' %> class="btn btn-block btn-black js-report-error">
            <%= t('views.shared.report_error') %>
            </<%= user_signed_in? ? 'a' : 'button' %>>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="main" class="l-map">
  <div id="map" class="vw-100 vh-100"></div>
  <div class="position-absolute w-100" style="top: 0;">
    <div class="container">
      <div class="position-relative">
        <div class="mt-2 d-flex justify-content-between">
          <button type="button" class="btn btn-black drawer-button" data-a11y-dialog-show="drawer">
            <svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" aria-label="<%= t('views.map.open_drawer') %>">
              <path d="M22 16.111v2.222H2v-2.222h20zm0-5.555v2.222H2v-2.222h20zM22 5v2.222H2V5h20z" fill-rule="evenodd" /></svg>
          </button>
          <% if user_signed_in? %>
          <% if params[:operation].nil? || params[:operation] != 'location' %>
          <%= link_to new_pin_path, class: 'flex-grow-1 mx-3 btn btn-primary text-center pin-button' do %>
          <svg class="d-inline-block mr-1" width="24" height="24" xmlns="http://www.w3.org/2000/svg">
            <g transform="translate(2 2)" fill-rule="nonzero" fill="none">
              <path d="M9.684 16.387a.499.499 0 0 0 .632 0C10.55 16.197 16 11.672 16 6A6 6 0 1 0 4 6c0 5.672 5.451 10.197 5.684 10.387zM7 6a3 3 0 1 1 6 0 3 3 0 0 1-6 0z" fill="#222" />
              <circle cx="10" cy="6" r="2" />
              <path d="M13.764 14.204a20.258 20.258 0 0 1-2.816 2.958 1.499 1.499 0 0 1-1.898-.002 20.226 20.226 0 0 1-2.814-2.956C3.014 14.566 0 15.446 0 17c0 1.97 5.03 3 10 3s10-1.03 10-3c0-1.554-3.014-2.434-6.236-2.796z" fill="#FFF" />
            </g>
          </svg>
          <%= t("views.shared.add_pin") %>
          <% end %>
          <% else %>
          <%= link_to map_index_path, class: 'flex-grow-1 mx-3 btn btn-secondary text-center pin-button' do %>
          <svg class="d-inline-block mr-1" width="24" height="24" xmlns="http://www.w3.org/2000/svg" class="d-block" aria-label="<%= t("views.shared.close_dialog") %>">
            <path d="M21.677 0l2.19 2.121-9.532 9.517.375.362-.375.362 9.532 9.517L21.677 24 12 14.625 2.323 24l-2.19-2.121 9.531-9.517L9.29 12l.374-.362-9.53-9.517L2.322 0 12 9.375 21.677 0z" fill="#222" fill-rule="evenodd" />
          </svg>
          <%= t("views.shared.cancel") %>
          <% end %>
          <% end %>
          <% else %>
          <button type="button" class="flex-grow-1 mx-3 btn btn-primary text-center pin-button" data-a11y-dialog-show="login-wall">
            <svg class="d-inline-block mr-1" width="24" height="24" xmlns="http://www.w3.org/2000/svg">
              <g transform="translate(2 2)" fill-rule="nonzero" fill="none">
                <path d="M9.684 16.387a.499.499 0 0 0 .632 0C10.55 16.197 16 11.672 16 6A6 6 0 1 0 4 6c0 5.672 5.451 10.197 5.684 10.387zM7 6a3 3 0 1 1 6 0 3 3 0 0 1-6 0z" fill="#222" />
                <circle cx="10" cy="6" r="2" />
                <path d="M13.764 14.204a20.258 20.258 0 0 1-2.816 2.958 1.499 1.499 0 0 1-1.898-.002 20.226 20.226 0 0 1-2.814-2.956C3.014 14.566 0 15.446 0 17c0 1.97 5.03 3 10 3s10-1.03 10-3c0-1.554-3.014-2.434-6.236-2.796z" fill="#FFF" />
              </g>
            </svg>
            <%= t("views.shared.add_pin") %>
          </button>
          <% end %>
          <button type="button" class="btn btn-secondary locate-button js-map-geolocation">
            <svg width="26" height="26" xmlns="http://www.w3.org/2000/svg" aria-label="<%= t('views.map.locate_me') %>">
              <g fill-rule="nonzero" transform="translate(-303 -99)">
                <path d="M316 119.607a7.561 7.561 0 0 0 7.608-7.607 7.562 7.562 0 0 0-7.607-7.607 7.562 7.562 0 0 0-7.607 7.607 7.562 7.562 0 0 0 7.607 7.607zm9.753-8.68h1.174a1.072 1.072 0 1 1 0 2.145h-1.174c-.51 4.545-4.136 8.17-8.68 8.681v1.174a1.072 1.072 0 1 1-2.145 0v-1.174c-4.545-.51-8.17-4.136-8.681-8.68h-1.174a1.072 1.072 0 1 1 0-2.145h1.174c.51-4.545 4.136-8.17 8.68-8.681v-1.174a1.072 1.072 0 1 1 2.145 0v1.174c4.545.51 8.17 4.136 8.681 8.68z" stroke="#FFF" stroke-width=".3" />
                <path d="M318.179 112a2.179 2.179 0 1 1-4.358 0 2.179 2.179 0 0 1 4.358 0z" />
              </g>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>